{% extends 'users_reports/base.html' %}

{% block title %}
Index
{% endblock title %}

{% block all_users_tab %}

<style>
    .table td {
        text-align: center;
        } 
</style>

<div class="container-md my-5">
    <div class="text-center">
        <span class="display-6 fw-bold">
            Active Directory Users - Domain: 3insys.com
        </span>
        <div class="container-md">
            <div class="row justify-content-center">
                <div class="col col-md-8">
                    <p class="lead mt-5"> This tool is used to show the current users information in the Active Directory. </p>
                </div>
            </div>
        </div>
    </div>
</div>
<div>
    {% if alert %}
        <div class="text-center">
        <div class="alert alert-success alert-dismissible fade show" role="alert" style="display: inline-block;">
        <p class="mb-0">{{alert}}</p>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endif %}
<div class="container-md text-start mb-5">
    <table class="table table-striped table-hover table-bordered table-responsive mb-5">
        <thead class="table-primary">
            <tr class="text-center">
                <th scope="col" rowspan="2">#</th>
                <th scope="col" rowspan="2">Full Name</th>
                <th scope="col" rowspan="2">Username</th>
                <th scope="col" rowspan="2">Password Last Set</th>
                <th scope="col" rowspan="2">Account Status</th>
                <th scope="col" rowspan="2">Email Address</th>
                <th scope="col" rowspan="2">Password Expires In</th>
                <th scope="col" colspan="3">Actions</th>
              </tr>
              <tr class="text-center">
                <th scope="col">Edit Password</th>
                <th scope="col">Set Status</th>
                <th scope="col">Set Lock Status</th>
              </tr>
        </thead>
        <tbody class="table-group-divider">
            {% for user in users %}
            
            <tr class="text-center">
                <th scope="row">{{user.id}}</th>
                <td class="lead">{{user.user_full_name}}</td>
                <td class="lead">{{user.user_sam_account_name}}</td>
                <td class="lead">{{user.user_pwd_last_set}}</td>
                {% if user.user_account_control == 512 %}
                <td class="lead">Active</td>
                {% elif user.user_account_control == 514 %}
                <td class="lead">Disabled</td>
                {% elif user.user_account_control == 66048 %}
                <td class="lead">Password Never Expires</td>
                {% elif user.user_account_control == 66050 %}
                <td class="lead">Disabled</td>
                {% else %}
                <td class="lead">{{ user.user_account_control }}</td>
                {% endif %}
                <td class="lead"><a href="mailto: {{ user.user_principle_name|lower }}">{{user.user_principle_name|lower}}</a></td>
                <td class="lead">{{user.user_account_remaining_days_for_password_expire}} days</td>
                <td class="lead"><button type="button" class="btn btn-warning btn-lg" data-bs-toggle="modal" data-bs-target="#changePasswordModal{{user.id}}" data-bs-whatever="@mdo"><i class="bi bi-pencil-square"></i></button></td>
                {% if user.user_account_control == 512 or user.user_account_control == 66048 %}
                <td class="lead"><button type="button" class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#currentactivatedstatusmodal{{user.id}}" data-bs-whatever="@mdo"><i class="bi bi-toggle2-on"></i></button></td>
                {% else %}
                <td class="lead"><button type="button" class="btn btn-danger btn-lg" data-bs-toggle="modal" data-bs-target="#currentdeactivatedstatusmodal{{user.id}}" data-bs-whatever="@mdo"><i class="bi bi-toggle2-off"></i></button></td>
                {% endif %}
                {% if user.user_lockout_status != 'unlocked' %}
                <td class="lead"><button type="button" class="btn btn-danger btn-lg" data-bs-toggle="modal" data-bs-target="#lockstatusmodal{{user.id}}" data-bs-whatever="@mdo"><i class="bi bi-lock"></i></button></td>
                {% else %}
                <td class="lead"><button type="button" class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#unlockstatusmodal{{user.id}}" data-bs-whatever="@mdo"><i class="bi bi-unlock"></i></button></td>
                {% endif %}
            </tr>
              
              {% include 'users_reports/adpasswordchange.html' %}
              {% include 'users_reports/current_status_modal.html' %}
              {% include 'users_reports/lock_status_modal.html' %}
              
            {% endfor %} 
            
        </tbody>
      </table>
    </div>
</div>
<section class="mb-5">

    <div class="alert alert-success" role="alert" style="display: inline-block;">
        <i class="bi bi-check-circle-fill"></i>&nbsp;<strong>{{user.username}}</strong> successfully logged in.
    </div>

</section>

<script>
    window.setTimeout(function() {
        $(".alert").fadeTo(500, 0).slideDown(500, function(){
            $(this).remove(); 
        });
    }, 4000);
</script>

{% endblock all_users_tab %}